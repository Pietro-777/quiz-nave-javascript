<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>QUIZ-JSN</title>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/nes.css/2.3.0/css/nes.min.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Press+Start+2P&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="static/css/index.css">
</head>
<body>
    <div class="quiz">
        <div class="container">
            <form action="#"> 
                <div class="testo-domanda">
                    <span class="question-number"></span>
                    <span class="question-text"></span>
                </div>
                <div class="bottone-testo">
                    <input type="text" name="answer" id="guess">
                    <br>
                    <input type="submit" id="button" value="Invia">
                </div>
            </form>
            <h2 class="result"></h2> 
            <div class="errors"></div>
        </div>
    </div>

    <script>
        let questions = [
            {
                "n_domanda": 1,
                "testo_domanda": "Qual è la capitale dell'Italia?",
                "risposta_corretta": "roma",
                "risposta_utente": "",
            },
            {
                "n_domanda": 2,
                "testo_domanda": "Qual è la capitale della Francia?",
                "risposta_corretta": "parigi",
                "risposta_utente": "",
            },
            {
                "n_domanda": 3,
                "testo_domanda": "Chi ha scritto La Divina Commedia?",
                "risposta_corretta": "dante alighieri",
                "risposta_utente": "",
            },
            {
                "n_domanda": 4,
                "testo_domanda": "Quanti colori ha l'arcobaleno?",
                "risposta_corretta": "sette",
                "risposta_utente": "",
            },
            {
                "n_domanda": 5,
                "testo_domanda": "Cosa fa una mucca su un altalena?",
                "risposta_corretta": "dondolatte",
                "risposta_utente": "",
            }
        ];

        let currentQuestion = 0;
        let score = 0;
        let ndomanda = document.querySelector(".question-number");
        let domanda = document.querySelector(".question-text");
        let form = document.querySelector("form");
        let inputRisposta = document.querySelector("#guess");
        let button = document.querySelector("#button");
        let resultDisplay = document.querySelector(".result");
        let errorDisplay = document.querySelector(".errors");

        function mostraDomanda() {
            if (currentQuestion < questions.length) {
                let obj = questions[currentQuestion];
                ndomanda.textContent = "Domanda " + obj.n_domanda;
                domanda.textContent = obj.testo_domanda;
                inputRisposta.value = "";
            } else {
                form.style.display = "none";
                mostraRisultati();
            }
        }

        function sanitize(input) {
            return input.trim().toLowerCase();
        }

        function mostraRisultati() {
            resultDisplay.textContent = "Hai risposto correttamente a " + score + " domande su " + questions.length;
            questions.forEach(q => {
                let div = document.createElement("div");
                div.classList.add("errore-singolo");

                let domandaP = document.createElement("p");
                domandaP.textContent = "Domanda " + q.n_domanda + ": " + q.testo_domanda;

                let rispostaCorretta = document.createElement("p");
                rispostaCorretta.textContent = "Risposta corretta: " + q.risposta_corretta;

                let rispostaUtente = document.createElement("p");
                rispostaUtente.textContent = "Tua risposta: " + (q.risposta_utente || "(nessuna risposta)");
                if (sanitize(q.risposta_utente) !== sanitize(q.risposta_corretta)) {
                    rispostaUtente.style.color = "red";
                } else {
                    rispostaUtente.style.color = "green";
                }

                div.appendChild(domandaP);
                div.appendChild(rispostaCorretta);
                div.appendChild(rispostaUtente);
                errorDisplay.appendChild(div);
            });
        }

        form.addEventListener("submit", function(e) {
            e.preventDefault();
            let rispostaUtente = sanitize(inputRisposta.value);
            let domandaCorrente = questions[currentQuestion];
            domandaCorrente.risposta_utente = rispostaUtente;

            if (rispostaUtente === sanitize(domandaCorrente.risposta_corretta)) {
                score++;
            }

            currentQuestion++;
            mostraDomanda();
        });

        window.addEventListener("load", function() {
            mostraDomanda();
        });
    </script>
</body>
</html>